# Task Card

## Metadata

- Task ID: TASK-2026-02-15-cli-v0.2-reviewlist
- Owner: Codex
- Date: 2026-02-15
- Priority: High
- Risk level: Medium

## Objective

在现有 CLI 基础上新增人工复核清单导出，并通过要求去重与合并降低重复触发。

## Definition of Done

1. `extract_requirements` 支持重复/近重复要求合并。
2. 新增 `checklist` 阶段输出 `manual-review.jsonl` 与 `manual-review.md`。
3. `run` 流程默认包含 checklist 产物。
4. 补充测试覆盖去重与清单导出。

## Scope

- In scope:
  - 要求抽取去重逻辑
  - 人工复核清单导出逻辑与 CLI 子命令
  - README 命令说明更新
- Out of scope:
  - LLM 二次判定
  - 文档二进制写回批注

## Plan

1. 实现 requirement merge 与高风险判定增强。
2. 实现 checklist 导出并接入 pipeline/cli。
3. 补充测试并运行验证。

## Verification

- Lint/static: N/A（当前未配置 lint）
- Tests: `python -m unittest discover -s tests -v`
- Build/typecheck: `python -m compileall bidagent tests`
- Smoke test: `python -m bidagent --help`

## Change Log

- Files touched:
  - `bidagent/review.py`
  - `bidagent/pipeline.py`
  - `bidagent/cli.py`
  - `README.md`
  - `tests/test_review.py`
  - `tests/test_cli_smoke.py`
  - `tests/test_checklist.py`
  - `docs/tasks/TASK-2026-02-15-cli-v0.2-reviewlist.md`
- Key decisions:
  - 在要求抽取阶段引入去重合并（精确归一化 + 同类关键词重叠）
  - 风险分级新增 `high risk`（针对“强制条款且仅弱证据命中”）
  - 新增 `checklist` 阶段，输出人工复核清单 sidecar 文件
- Tradeoffs:
  - 去重仍是规则启发式，可能存在少量“误合并/漏合并”
  - 人工复核清单目前只基于 `fail` 与 `severity=high`，还未引入业务可配置阈值

## Handoff

- Summary:
  - 已实现要求去重与合并，减少重复条款重复判定
  - 已新增 `checklist` 阶段，并接入 `run` 全流程
  - 已新增测试覆盖去重、高风险判定、清单导出
- Remaining risks:
  - 大量近义改写条款仍可能需要 LLM 语义聚合增强
  - `high risk` 当前阈值是固定规则，后续需按项目历史数据调参
- Recommended next step:
  - 用真实项目结果对 `manual-review.jsonl` 做人工抽样复核并调整阈值
