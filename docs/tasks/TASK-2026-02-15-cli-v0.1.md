# Task Card

## Metadata

- Task ID: TASK-2026-02-15-cli-v0.1
- Owner: Codex
- Date: 2026-02-15
- Priority: High
- Risk level: Medium

## Objective

交付一个可运行的 AI 标书审查 CLI 闭环骨架，支持超大文档场景下的分阶段处理和可恢复执行。

## Definition of Done

1. 提供 `ingest/extract-req/review/annotate/report/run` 六个 CLI 子命令。
2. 产出结构化结果文件：`requirements.jsonl`、`findings.jsonl`、`annotations.jsonl`、`review-report.md`。
3. 支持大文档参数：`--resume`、`--workers`、`--batch-size`、`--focus business`。
4. 提供最小自动化测试与可执行验证命令。

## Scope

- In scope:
  - Python CLI 骨架与流水线编排
  - PDF/DOCX/TXT 解析接口（PDF 为可选依赖后端）
  - 商务规则提取与启发式审查
  - 侧边标注产物（JSONL + Markdown）
- Out of scope:
  - 高精度模型调优
  - 真正写回 PDF/DOCX 二进制批注
  - 云端部署与多租户鉴权

## Plan

1. 建立项目结构与命令行入口。
2. 实现流式文档读取、要求抽取、审查与报告生成。
3. 编写测试并执行验证脚本。

## Verification

- Lint/static: N/A（当前未配置 lint）
- Tests: `python -m unittest discover -s tests -v`
- Build/typecheck: `python -m compileall bidagent`
- Smoke test: 使用临时 TXT 文档执行 `python -m bidagent run ...`

## Change Log

- Files touched:
  - `pyproject.toml`
  - `README.md`
  - `bidagent/__init__.py`
  - `bidagent/__main__.py`
  - `bidagent/cli.py`
  - `bidagent/document.py`
  - `bidagent/io_utils.py`
  - `bidagent/models.py`
  - `bidagent/pipeline.py`
  - `bidagent/review.py`
  - `tests/test_cli_smoke.py`
  - `tests/test_review.py`
  - `docs/tasks/TASK-2026-02-15-cli-v0.1.md`
- Key decisions:
  - 采用“规则优先 + 语义补充”的架构
  - 为超大文档采用分阶段落盘和恢复机制
  - `review` 阶段改为单次流式扫描投标块，避免全量加载文档块
- Tradeoffs:
  - 标注先输出 sidecar（`annotations.jsonl` + `annotations.md`），不直接改写 PDF/DOCX 二进制批注
  - PDF 解析使用可选依赖 `pypdf`，未安装时会明确报错

## Handoff

- Summary:
  - 已交付 CLI 闭环骨架：`ingest/extract-req/review/annotate/report/run`
  - 已实现大文档友好流程：分阶段产物落盘 + `--resume`
  - 已实现商务优先审查与技术条款过滤（`--focus business`）
- Remaining risks:
  - 当前规则与打分为启发式，真实项目需引入 LLM 语义链路与人工反馈迭代
  - 还未实现直接写回 PDF/DOCX 批注（仅 sidecar 标注）
  - 超大扫描件 OCR 管线尚未接入
- Recommended next step:
  - 接入 LLM 要求抽取与证据判定节点，保留当前规则作为兜底
